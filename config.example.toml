# shortlinker 配置文件示例
# 以下配置必须在启动前设置，修改后需要重启服务
# 其他配置（API、路由、功能等）已迁移到数据库，可通过管理面板动态修改
#
# 安全配置说明：
# - 登录限流智能检测：未配置 api.trusted_proxies 时，连接来自私有 IP（Docker/nginx）
#   将自动信任 X-Forwarded-For header，适合绝大多数反向代理部署
# - 显式配置：如需精确控制，可在管理面板配置 api.trusted_proxies（支持 IP 和 CIDR）
#   示例：Docker 部署可配置为 ["172.16.0.0/12"]，nginx 反向代理可配置为代理服务器 IP
# - IPC socket 权限已限制为 0600（仅属主可访问）

[server]
# 服务器监听地址
host = "127.0.0.1"

# 服务器监听端口
port = 8080

# Unix Socket 路径（如果设置了，会覆盖 host 和 port）
# unix_socket = "/tmp/shortlinker.sock"

# CPU 核心数量（默认为系统核心数）
# cpu_count = 4

[database]
# 数据库连接 URL 或文件路径
# 数据库类型会从 URL scheme 自动检测：
# - sqlite:// 或 .db/.sqlite 文件 → SQLite
# - postgres:// 或 postgresql:// → PostgreSQL
# - mysql:// → MySQL
# - mariadb:// → MariaDB（使用 MySQL 协议）
database_url = "shortlinks.db"

# 数据库连接池大小
pool_size = 10

# 数据库连接超时（秒）
timeout = 30

[cache]
# 缓存类型：memory, redis
type = "memory"

# 默认缓存过期时间（秒）
default_ttl = 3600

[cache.redis]
# Redis 连接 URL
url = "redis://127.0.0.1:6379/"

# Redis 键前缀
key_prefix = "shortlinker:"

[cache.memory]
# 内存缓存最大容量（条目数）
max_capacity = 10000

[logging]
# 日志等级：trace, debug, info, warn, error
level = "info"

# 日志输出格式：text, json
format = "text"

# 日志文件路径（不设置则输出到控制台）
# file = "shortlinker.log"

# 日志文件最大大小（MB）
max_size = 100

# 保留的日志文件数量
max_backups = 5

# 是否启用日志轮转
enable_rotation = true
